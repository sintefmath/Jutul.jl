<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Internals · Jutul.jl</title><meta name="title" content="Internals · Jutul.jl"/><meta property="og:title" content="Internals · Jutul.jl"/><meta property="twitter:title" content="Internals · Jutul.jl"/><meta name="description" content="Documentation for Jutul.jl."/><meta property="og:description" content="Documentation for Jutul.jl."/><meta property="twitter:description" content="Documentation for Jutul.jl."/><meta property="og:url" content="https://sintefmath.github.io/Jutul.jl/internals/"/><meta property="twitter:url" content="https://sintefmath.github.io/Jutul.jl/internals/"/><link rel="canonical" href="https://sintefmath.github.io/Jutul.jl/internals/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Jutul.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../usage/">Usage</a></li><li><a class="tocitem" href="../optimization/">Sensitivities, adjoints and optimization</a></li><li><a class="tocitem" href="../mesh/">Meshes and mesh utilities</a></li><li><a class="tocitem" href="../units/">Units</a></li><li class="is-active"><a class="tocitem" href>Internals</a><ul class="internal"><li><a class="tocitem" href="#Entities-and-variables"><span>Entities and variables</span></a></li><li><a class="tocitem" href="#Equations"><span>Equations</span></a></li><li><a class="tocitem" href="#Automatic-differentiation"><span>Automatic differentiation</span></a></li><li><a class="tocitem" href="#Matrix"><span>Matrix</span></a></li><li><a class="tocitem" href="#Various"><span>Various</span></a></li></ul></li><li><a class="tocitem" href="../docstrings/">Docstrings</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Internals</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Internals</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/sintefmath/Jutul.jl/blob/main/docs/src/internals.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Internal-docstrings"><a class="docs-heading-anchor" href="#Internal-docstrings">Internal docstrings</a><a id="Internal-docstrings-1"></a><a class="docs-heading-anchor-permalink" href="#Internal-docstrings" title="Permalink"></a></h1><p>These functions are mostly relevant for implementing simulators in the Jutul framework.</p><h2 id="Entities-and-variables"><a class="docs-heading-anchor" href="#Entities-and-variables">Entities and variables</a><a id="Entities-and-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Entities-and-variables" title="Permalink"></a></h2><h3 id="Variables"><a class="docs-heading-anchor" href="#Variables">Variables</a><a id="Variables-1"></a><a class="docs-heading-anchor-permalink" href="#Variables" title="Permalink"></a></h3><p>Variable types:</p><article><details class="docstring" open="true"><summary id="Jutul.JutulVariables"><a class="docstring-binding" href="#Jutul.JutulVariables"><code>Jutul.JutulVariables</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Abstract type for all variables in Jutul.</p><p>A variable is associated with a <a href="#Jutul.JutulEntity"><code>JutulEntity</code></a> through the <a href="#Jutul.associated_entity"><code>associated_entity</code></a> function. A variable is local to that entity, and cannot depend on other entities. Variables are used by models to define:</p><ul><li>primary variables: Sometimes referred to as degrees of freedom, primary unknowns or solution variables</li><li>parameters: Static quantities that impact the solution</li><li>secondary variables: Can be computed from a combination of other primary and secondary variables and parameters.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/core_types/core_types.jl#L45-L56">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.ScalarVariable"><a class="docstring-binding" href="#Jutul.ScalarVariable"><code>Jutul.ScalarVariable</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Abstract type for scalar variables (one entry per entity, e.g. pressure or temperature in each cell of a model)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/core_types/core_types.jl#L59-L62">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.VectorVariables"><a class="docstring-binding" href="#Jutul.VectorVariables"><code>Jutul.VectorVariables</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Abstract type for vector variables (more than one entry per entity, for example saturations or displacements)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/core_types/core_types.jl#L64-L67">source</a></section></details></article><p>Variables API:</p><article><details class="docstring" open="true"><summary id="Jutul.degrees_of_freedom_per_entity"><a class="docstring-binding" href="#Jutul.degrees_of_freedom_per_entity"><code>Jutul.degrees_of_freedom_per_entity</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>Number of independent primary variables / degrees of freedom per computational entity.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/variables/utils.jl#L73-L75">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.values_per_entity"><a class="docstring-binding" href="#Jutul.values_per_entity"><code>Jutul.values_per_entity</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>Number of values held by a primary variable. Normally this is equal to the number of degrees of freedom, but some special primary variables are most conveniently defined by having N values and N-1 independent variables.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/variables/utils.jl#L79-L82">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.maximum_value"><a class="docstring-binding" href="#Jutul.maximum_value"><code>Jutul.maximum_value</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>Upper (inclusive) limit for variable.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/variables/utils.jl#L98-L100">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.minimum_value"><a class="docstring-binding" href="#Jutul.minimum_value"><code>Jutul.minimum_value</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>Lower (inclusive) limit for variable.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/variables/utils.jl#L103-L105">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.variable_scale"><a class="docstring-binding" href="#Jutul.variable_scale"><code>Jutul.variable_scale</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>Define a &quot;typical&quot; numerical value for a variable to scale the linear system entries.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/variables/utils.jl#L190-L192">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.absolute_increment_limit"><a class="docstring-binding" href="#Jutul.absolute_increment_limit"><code>Jutul.absolute_increment_limit</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>Absolute allowable change for variable during a nonlinear update.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/variables/utils.jl#L86-L88">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.relative_increment_limit"><a class="docstring-binding" href="#Jutul.relative_increment_limit"><code>Jutul.relative_increment_limit</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>Relative allowable change for variable during a nonlinear update. A variable with value |x| and relative limit 0.2 cannot change more than |x|*0.2.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/variables/utils.jl#L91-L95">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.associated_entity"><a class="docstring-binding" href="#Jutul.associated_entity"><code>Jutul.associated_entity</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>Return the domain entity the equation is associated with</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/equations.jl#L259-L261">source</a></section><section><div><p>The entity a variable is associated with, and can hold partial derivatives with respect to.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/variables/utils.jl#L9-L11">source</a></section></details></article><p>Updating variables</p><article><details class="docstring" open="true"><summary id="Jutul.@jutul_secondary"><a class="docstring-binding" href="#Jutul.@jutul_secondary"><code>Jutul.@jutul_secondary</code></a> — <span class="docstring-category">Macro</span></summary><section><div><p>Designate the function as updating a secondary variable.</p><p>A generic evaluator is then defined, together with a function for getting the dependencies of that function upon the state. This is most easily documented with an example. If we define the following function annotated with the macro when updating the array containing the values of <code>MyVarType</code> realized for some model:</p><pre><code class="language-julia hljs">@jutul_secondary function some_fn!(target, var::MyVarType, model, a, b, c, ix)
    for i in ix
        target[i] = a[i] + b[i] / c[i]
    end
end</code></pre><p>The purpose of the macro is to translate this into two functions. The first defines for the dependencies of the function with respect to the fields of the state (primary variables, secondary variables and parameters):</p><pre><code class="language-julia hljs">function get_dependencies(var::MyVarType, model)
   return (:a, :b, :c)
end</code></pre><p>The second function defines a generic version that takes in state, and automatically expands the set of dependencies into <code>getfield</code> calls.</p><pre><code class="language-julia hljs">function update_secondary_variable!(array_target, var::MyVarType, model, state, ix)
    some_fn!(array_target, var, model, state.a, state.b, state.c, ix)
end</code></pre><p>Note that the input names of arguments 4 to end-1 matter, as these will be fetched from state, exactly as written.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/variable_evaluation.jl#L4-L37">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.get_dependencies"><a class="docstring-binding" href="#Jutul.get_dependencies"><code>Jutul.get_dependencies</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>Get dependencies of variable when viewed as a secondary variable. Normally autogenerated with @jutul_secondary</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/variable_evaluation.jl#L214-L216">source</a></section></details></article><h3 id="Entities"><a class="docs-heading-anchor" href="#Entities">Entities</a><a id="Entities-1"></a><a class="docs-heading-anchor-permalink" href="#Entities" title="Permalink"></a></h3><article><details class="docstring" open="true"><summary id="Jutul.JutulEntity"><a class="docstring-binding" href="#Jutul.JutulEntity"><code>Jutul.JutulEntity</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Super-type for all entities where <a href="#Jutul.JutulVariables"><code>JutulVariables</code></a> can be defined.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/core_types/core_types.jl#L476-L478">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.Cells"><a class="docstring-binding" href="#Jutul.Cells"><code>Jutul.Cells</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Entity for Cells (closed volumes with averaged properties for a finite-volume solver)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/core_types/core_types.jl#L481-L483">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.Faces"><a class="docstring-binding" href="#Jutul.Faces"><code>Jutul.Faces</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Entity for Faces (intersection between pairs of <a href="#Jutul.Cells"><code>Cells</code></a>)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/core_types/core_types.jl#L486-L488">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.Nodes"><a class="docstring-binding" href="#Jutul.Nodes"><code>Jutul.Nodes</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Entity for Nodes (intersection between multiple <a href="#Jutul.Faces"><code>Faces</code></a>)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/core_types/core_types.jl#L501-L503">source</a></section></details></article><p>Entities API</p><article><details class="docstring" open="true"><summary id="Jutul.number_of_partials_per_entity"><a class="docstring-binding" href="#Jutul.number_of_partials_per_entity"><code>Jutul.number_of_partials_per_entity</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">number_of_partials_per_entity(model::SimulationModel, entity::JutulEntity)</code></pre><p>Get the number of local partial derivatives per entity in a <code>model</code> for a given <a href="#Jutul.JutulEntity"><code>JutulEntity</code></a>. This is the sum of <a href="#Jutul.degrees_of_freedom_per_entity"><code>degrees_of_freedom_per_entity</code></a> for all primary variables defined on <code>entity</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/models.jl#L218-L223">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.number_of_entities"><a class="docstring-binding" href="#Jutul.number_of_entities"><code>Jutul.number_of_entities</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>Get the number of entities (e.g. the number of cells) that the equation is defined on.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/equations.jl#L286-L288">source</a></section><section><div><p>Get number of entities a cache is defined on.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/ad/ad.jl#L3-L5">source</a></section><section><div><p>Number of entities for vector stored in state (just the number of elements)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/ad/ad.jl#L9-L11">source</a></section><section><div><p>Number of entities for matrix stored in state (convention is number of columns)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/ad/ad.jl#L14-L16">source</a></section><section><div><p>Number of entities (e.g. Cells, Faces) a variable is defined on. By default, each primary variable exists on all cells of a discretized domain</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/variables/utils.jl#L2-L6">source</a></section></details></article><h2 id="Equations"><a class="docs-heading-anchor" href="#Equations">Equations</a><a id="Equations-1"></a><a class="docs-heading-anchor-permalink" href="#Equations" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="Jutul.JutulEquation"><a class="docstring-binding" href="#Jutul.JutulEquation"><code>Jutul.JutulEquation</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Abstract type for all residual equations</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/core_types/core_types.jl#L229-L231">source</a></section></details></article><p>Equations API</p><article><details class="docstring" open="true"><summary id="Jutul.number_of_equations"><a class="docstring-binding" href="#Jutul.number_of_equations"><code>Jutul.number_of_equations</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>Get the total number of equations on the domain of model.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/equations.jl#L293-L295">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.number_of_equations_per_entity"><a class="docstring-binding" href="#Jutul.number_of_equations_per_entity"><code>Jutul.number_of_equations_per_entity</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">n = number_of_equations_per_entity(model::JutulModel, eq::JutulEquation)</code></pre><p>Get the number of equations per entity. For example, mass balance of two components will have two equations per grid cell (= entity)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/equations.jl#L267-L272">source</a></section></details></article><h2 id="Automatic-differentiation"><a class="docs-heading-anchor" href="#Automatic-differentiation">Automatic differentiation</a><a id="Automatic-differentiation-1"></a><a class="docs-heading-anchor-permalink" href="#Automatic-differentiation" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="Jutul.value"><a class="docstring-binding" href="#Jutul.value"><code>Jutul.value</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>Take value of AD.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/ad/ad.jl#L436-L438">source</a></section><section><div><pre><code class="language-julia hljs">value(d::Dict)</code></pre><p>Call value on all elements of some Dict.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/ad/ad.jl#L464-L467">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.as_value"><a class="docstring-binding" href="#Jutul.as_value"><code>Jutul.as_value</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>Create a mapped array that produces only the values when indexed.</p><p>Only useful for AD arrays, otherwise it does nothing.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/ad/ad.jl#L476-L480">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.local_ad"><a class="docstring-binding" href="#Jutul.local_ad"><code>Jutul.local_ad</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">local_ad(state::T, index::I, ad_tag::∂T) where {T, I&lt;:Integer, ∂T}</code></pre><p>Create local<em>ad for state for index I of AD tag of type ad</em>tag</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/ad/local_ad.jl#L180-L184">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.JutulAutoDiffCache"><a class="docstring-binding" href="#Jutul.JutulAutoDiffCache"><code>Jutul.JutulAutoDiffCache</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>An AutoDiffCache is a type that holds both a set of AD values and a map into some global Jacobian.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/core_types/core_types.jl#L689-L692">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.CompactAutoDiffCache"><a class="docstring-binding" href="#Jutul.CompactAutoDiffCache"><code>Jutul.CompactAutoDiffCache</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Cache that holds an AD vector/matrix together with their positions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/core_types/core_types.jl#L694-L696">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.allocate_array_ad"><a class="docstring-binding" href="#Jutul.allocate_array_ad"><code>Jutul.allocate_array_ad</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">allocate_array_ad(n[, m]; &lt;keyword arguments&gt;)</code></pre><p>Allocate vector or matrix as AD with optionally provided context and a specified non-zero on the diagonal.</p><p><strong>Arguments</strong></p><ul><li><code>n::Integer</code>: number of entries in vector, or number of rows if <code>m</code> is given.</li><li><code>m::Integer</code>: number of rows (optional)</li></ul><p><strong>Keyword arguments</strong></p><ul><li><code>npartials = 1</code>: Number of partials derivatives to allocate for each element</li><li><code>diag_pos = nothing</code>: Indices of where to put entities on the diagonal (if any)</li></ul><p>Other keyword arguments are passed onto <code>get_ad_entity_scalar</code>.</p><p><strong>Examples:</strong></p><p>Allocate a vector with a single partial:</p><pre><code class="language-julia-repl hljs">julia&gt; allocate_array_ad(2)
2-element Vector{ForwardDiff.Dual{nothing, Float64, 1}}:
 Dual{nothing}(0.0,0.0)
 Dual{nothing}(0.0,0.0)</code></pre><p>Allocate a vector with two partials, and set the first to one:</p><pre><code class="language-julia-repl hljs">julia&gt; allocate_array_ad(2, diag_pos = 1, npartials = 2)
2-element Vector{ForwardDiff.Dual{nothing, Float64, 2}}:
 Dual{nothing}(0.0,1.0,0.0)
 Dual{nothing}(0.0,1.0,0.0)</code></pre><p>Set up a matrix with two partials, where the first column has partials [1, 0] and the second [0, 1]:</p><pre><code class="language-julia-repl hljs">julia&gt; allocate_array_ad(2, 2, diag_pos = [1, 2], npartials = 2)
2×2 Matrix{ForwardDiff.Dual{nothing, Float64, 2}}:
 Dual{nothing}(0.0,1.0,0.0)  Dual{nothing}(0.0,1.0,0.0)
 Dual{nothing}(0.0,0.0,1.0)  Dual{nothing}(0.0,0.0,1.0)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/ad/ad.jl#L278-L316">source</a></section><section><div><pre><code class="language-julia hljs">allocate_array_ad(v::AbstractVector, ...)</code></pre><p>Convert vector to AD vector.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/ad/ad.jl#L336-L339">source</a></section><section><div><pre><code class="language-julia hljs">allocate_array_ad(v::AbstractMatrix, ...)</code></pre><p>Convert matrix to AD matrix.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/ad/ad.jl#L347-L350">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.get_ad_entity_scalar"><a class="docstring-binding" href="#Jutul.get_ad_entity_scalar"><code>Jutul.get_ad_entity_scalar</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">get_ad_entity_scalar(v::Real, npartials, diag_pos = nothing; &lt;keyword_arguments&gt;)</code></pre><p>Get scalar with partial derivatives as AD instance.</p><p><strong>Arguments</strong></p><ul><li><code>v::Real</code>: Value of AD variable.</li><li><code>npartials</code>: Number of partial derivatives each AD instance holds.</li><li><code>diag_pos</code> = nothing: Position(s) of where to set 1 as the partial derivative instead of zero.</li></ul><p><strong>Keyword arguments</strong></p><ul><li><code>tag = nothing</code>: Tag for AD instance. Two AD values of the different tag cannot interoperate to avoid perturbation confusion (see ForwardDiff documentation).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/ad/ad.jl#L357-L369">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.get_entries"><a class="docstring-binding" href="#Jutul.get_entries"><code>Jutul.get_entries</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>Get the entries of the main autodiff cache for an equation.</p><p>Note: This only gets the .equation field&#39;s entries.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/ad/ad.jl#L19-L23">source</a></section><section><div><p>Get entries of autodiff cache. Entries are AD vectors that hold values and derivatives.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/ad/compact.jl#L1-L3">source</a></section></details></article><h2 id="Matrix"><a class="docs-heading-anchor" href="#Matrix">Matrix</a><a id="Matrix-1"></a><a class="docs-heading-anchor-permalink" href="#Matrix" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="Jutul.JutulMatrixLayout"><a class="docstring-binding" href="#Jutul.JutulMatrixLayout"><code>Jutul.JutulMatrixLayout</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Abstract type for matrix layouts. A layout determines how primary variables and equations are ordered in a sparse matrix representation. Note that this is different from the matrix format itself as it concerns the ordering itself: For example, if all equations for a single cell come in sequence, or if a single equation is given for all entities before the next equation is written.</p><p>Different layouts does not change the solution of the system, but different linear solvers support different layouts.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/core_types/core_types.jl#L91-L100">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.EntityMajorLayout"><a class="docstring-binding" href="#Jutul.EntityMajorLayout"><code>Jutul.EntityMajorLayout</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Equations are grouped by entity, listing all equations and derivatives for entity 1 before proceeding to entity 2 etc.</p><p>For a test system with primary variables P, S and equations E1, E2 and two cells this will give the following ordering on the diagonal: (∂E1/∂p)₁, (∂E2/∂S)₁, (∂E1/∂p)₂, (∂E2/∂S)₂</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/core_types/core_types.jl#L115-L122">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.EquationMajorLayout"><a class="docstring-binding" href="#Jutul.EquationMajorLayout"><code>Jutul.EquationMajorLayout</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Equations are stored sequentially in rows, derivatives of same type in columns:</p><p>For a test system with primary variables P, S and equations E1, E2 and two cells this will give the following ordering on the diagonal: (∂E1/∂p)₁, (∂E1/∂p)₂, (∂E2/∂S)₁, (∂E2/∂S)₂</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/core_types/core_types.jl#L102-L108">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.BlockMajorLayout"><a class="docstring-binding" href="#Jutul.BlockMajorLayout"><code>Jutul.BlockMajorLayout</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Same as <a href="#Jutul.EntityMajorLayout"><code>EntityMajorLayout</code></a>, but the system is a sparse matrix where each entry is a small dense matrix.</p><p>For a test system with primary variables P, S and equations E1, E2 and two cells this will give a diagonal of length 2: [(∂E1/∂p)₁ (∂E1/∂S)₁ ; (∂E2/∂p)₁ (∂E2/∂S)₁] [(∂E1/∂p)₂ (∂E1/∂S)₂ ; (∂E2/∂p)₂ (∂E2/∂S)₂]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/core_types/core_types.jl#L131-L139">source</a></section></details></article><h2 id="Various"><a class="docs-heading-anchor" href="#Various">Various</a><a id="Various-1"></a><a class="docs-heading-anchor-permalink" href="#Various" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="Jutul.convergence_criterion"><a class="docstring-binding" href="#Jutul.convergence_criterion"><code>Jutul.convergence_criterion</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">convergence_criterion(model, storage, eq, eq_s, r; dt = 1)</code></pre><p>Get the convergence criterion values for a given equation. Can be checked against the corresponding tolerances.</p><p><strong>Arguments</strong></p><ul><li><code>model</code>: model that generated the current equation.</li><li><code>storage</code>: global simulator storage.</li><li><code>eq::JutulEquation</code>: equation implementation currently being checked</li><li><code>eq_s</code>: storage for <code>eq</code> where values are contained.</li><li><code>r</code>: the local residual part corresponding to this model, as a matrix with column index equaling entity index</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/equations.jl#L591-L602">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.partition"><a class="docstring-binding" href="#Jutul.partition"><code>Jutul.partition</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">partition(N::AbstractMatrix, num_coarse, weights = ones(size(N, 2)); partitioner = MetisPartitioner(), groups = nothing, n = maximum(N), group_by_weights = false, buffer_group = true)</code></pre><p>Partition based on neighborship (with optional groups kept contigious after partitioning)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/partitioning.jl#L238-L243">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Jutul.load_balanced_endpoint"><a class="docstring-binding" href="#Jutul.load_balanced_endpoint"><code>Jutul.load_balanced_endpoint</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">load_balanced_endpoint(block_index, nvals, nblocks)</code></pre><p>Endpoint for interval <code>block_index</code> that subdivides <code>nvals</code> into <code>nblocks</code> in a load balanced manner. This is done by adding one element to the first set of blocks whenever possible.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/10593483dfa836760f3fe1460964216ef7dfa1cc/src/partitioning.jl#L310-L316">source</a></section></details></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../units/">« Units</a><a class="docs-footer-nextpage" href="../docstrings/">Docstrings »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Thursday 12 February 2026 17:08">Thursday 12 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
